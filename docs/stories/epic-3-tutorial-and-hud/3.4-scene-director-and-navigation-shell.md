# Godot Story: SceneDirector & Navigation Shell

**Epic:** Epic 3 – Tutorial Onboarding, HUD, and Accessibility  
**Story ID:** 3.4  
**Priority:** High  
**Points:** 5  
**Status:** Draft  
**Language:** GDScript  
**Performance Target:** 60+ FPS

## Description
Establish the front-end scene shell so players land on a Title screen, navigate the Main Menu, and transition into gameplay, tutorial, practice, and records screens without editor hacks. Implement a `SceneDirector` autoload that manages async loading, fade transitions, and input locking while broadcasting analytics for each transition. [Source: docs/front-end-spec.md#screen-specifications][Source: docs/architecture/scene-management-architecture.md#scene-structure][Source: docs/architecture/high-level-architecture.md#high-level-overview]

**Godot Implementation:** Author Title, Main Menu, Pause, Options, Records, Game Over scenes with responsive layouts per UX spec, and update `project.godot` to boot through `SceneDirector`. Integrate navigation telemetry, safe-area adjustments, and controller/touch parity. [Source: docs/front-end-spec.md#screen-specifications][Source: docs/architecture/ui-architecture.md#ui-system-selection][Source: docs/architecture/game-systems-components.md#system-interaction-session-core]

**Performance Impact:** Preload next scene resources, reuse CanvasLayer overlays, and defer expensive loads to background threads to maintain <16.67 ms frame time even on mid-tier mobile hardware. [Source: docs/architecture/performance-and-security-considerations.md#performance-budgets][Source: docs/architecture/rendering-pipeline-configuration.md#rendering-optimization]

## Acceptance Criteria
### Functional Requirements
- Project boot path flows: Splash/Title → Main Menu → (Start Run/Tutorial/Practice/Records) as defined in UX spec. [Source: docs/front-end-spec.md#screen-specifications][Source: docs/architecture/scene-management-architecture.md#scene-structure]
- `SceneDirector` autoload exposes `push_scene()`, `pop_scene()`, and `transition_to(scene_id, metadata)` with fade effects and input locking. [Source: docs/architecture/scene-management-architecture.md#scene-loading-system][Source: docs/architecture/godot-development-conventions.md#workflow-conventions]
- Pause overlay and Options screen can be invoked from gameplay scenes via `SceneDirector`; returning to session restores state. [Source: docs/front-end-spec.md#screen-specifications][Source: docs/architecture/game-systems-components.md#system-interaction-session-core]
- Analytics emits `screen_view` events for each transition with scene id, duration, and entry reason. [Source: docs/architecture/analytics-integration.md#event-design]

### Technical Requirements
- Typed GDScript across navigation services and scenes. [Source: docs/architecture/godot-development-conventions.md#best-practices]
- Title/Main/Pause/Options/Records scenes stored under `res://ui/screens/`, using reusable control components and following safe-area guidelines. [Source: docs/front-end-spec.md#screen-specifications][Source: docs/architecture/ui-component-system.md#component-library]
- Resource prefetch queue prevents frame stalls >5 ms during scene swaps; fade animation capped at 250 ms. [Source: docs/architecture/performance-and-security-considerations.md#performance-budgets]
- `SceneDirector` registers with `SignalHub` for pause/resume events and disconnects cleanly on shutdown. [Source: docs/architecture/game-systems-components.md#system-interaction-session-core]
- GUT/UI tests validate transition graph (Title↔Menu↔Session, Pause overlay, Game Over return). [Source: docs/architecture/test-strategy-and-standards.md#godot-test-types-and-organization]

### Game Design Requirements
- Title and menu scenes apply cozy palette, animated mascots, and audio cues defined in audio spec. [Source: docs/game-prd.md#goals-and-background-context][Source: docs/architecture/audio-architecture.md#system-design]
- Menu layout stays within thumb arcs, supports screen readers (accessibility copy ready). [Source: docs/front-end-spec.md#screen-specifications]
- Transition fades align with UX direction (ease in/out cubic, 0.2 s) and respect accessibility toggle for reduced motion. [Source: docs/front-end-spec.md#screen-specifications][Source: docs/stories/epic-3-tutorial-and-hud/3.3-accessibility-toggles-and-localization-hooks.md#acceptance-criteria]

## Technical Specifications
### Files to Create/Modify
**New Autoload:**
- `res://autoload/scene_director.gd` – Manages scene stack, transitions, analytics hooks. [Source: docs/architecture/scene-management-architecture.md#scene-loading-system]

**New Scenes (.tscn):**
- `res://ui/screens/title_screen.tscn`
- `res://ui/screens/main_menu.tscn`
- `res://ui/screens/options_screen.tscn`
- `res://ui/screens/records_screen.tscn`
- `res://ui/screens/game_over.tscn`

**New Scripts:**
- `res://scripts/ui/title_screen.gd`
- `res://scripts/ui/main_menu.gd`
- `res://scripts/ui/options_screen.gd`
- `res://scripts/ui/records_screen.gd`
- `res://scripts/ui/game_over_screen.gd`

**Modified Files:**
- `project.godot` – Update run/main_scene to SceneDirector boot scene. [Source: docs/architecture/scene-management-architecture.md#scene-structure]
- `res://scenes/session/SessionRoot.tscn` – Register pause hooks with SceneDirector. [Source: docs/architecture/high-level-architecture.md#high-level-overview]
- `res://autoload/signal_hub.gd` – Add navigation/pause signals. [Source: docs/architecture/game-systems-components.md#system-interaction-session-core]
- `scripts/run-headless-checks.sh` – Add navigation smoke test invocation. [Source: docs/architecture/test-strategy-and-standards.md#automation-guidelines]

### Resource Dependencies
- UI Theme: `res://ui/themes/cozy_theme.tres`
- Localization strings: `res://resources/i18n/ui_screens.csv`
- Transition shader: `res://resources/shaders/fade_transition.tres`

## Testing Requirements
### Automated
- GUT test: `res://tests/gut/ui/test_scene_director.gd` covering push/pop/transition graph and reduced-motion flag.
- Headless navigation smoke: load Title→Menu→Session→GameOver in `scripts/run-headless-checks.sh`.

### Manual QA
- Device matrix: iPhone 12 portrait/landscape, Pixel 6 portrait/landscape, controller input on Android build.
- Accessibility: Reduced motion, colorblind palettes, screen reader focus order.
- Performance: Scene swap frame time capture <16.67 ms via profiler.

## Definition of Done
- All acceptance criteria fulfilled and validated via automated + manual checks.
- UX Expert sign-off on Title/Menu/Pause/Game Over screens.
- QA gate recorded with PASS decision; regression list updated.
- Documentation updated for navigation workflow and analytics events.

## Notes
- Follow state machine architecture guidelines for scene stack transitions.
- Coordinate with Audio/Haptics story to ensure scene cues trigger correct events.
- Keep navigation architecture extensible for future seasonal events (e.g., holiday menu skin).
